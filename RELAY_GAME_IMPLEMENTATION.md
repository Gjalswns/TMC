# Relay Game κµ¬ν„ μ™„λ£

## π― κ²μ„ λ©”μ»¤λ‹μ¦

### κΈ°λ³Έ κµ¬μ΅°
- **λ¬Έμ  μ„ΈνΈ**: P, Q, R, S (4κ° μ„ΈνΈ)
- **κ° μ„ΈνΈλ‹Ή λ¬Έμ **: 4κ° (1, 2, 3, 4λ²)
- **ν€ κµ¬μ„±**: 4λ… (A, B, C, D)
- **μ΄ λΌμ΄λ“**: 4λΌμ΄λ“ (μ‚¬μ΄ν΄)

### μ§„ν–‰ λ°©μ‹

#### λΌμ΄λ“ 1 (Cycle 1)
```
A β†’ P-1 (ννΈ μ—†μ)
B β†’ Q-1 (ννΈ μ—†μ)
C β†’ R-1 (ννΈ μ—†μ)
D β†’ S-1 (ννΈ μ—†μ)
```

#### λΌμ΄λ“ 2 (Cycle 2)
```
A β†’ Q-2 (ννΈ: P-1 μ •λ‹µ)
B β†’ R-2 (ννΈ: Q-1 μ •λ‹µ)
C β†’ S-2 (ννΈ: R-1 μ •λ‹µ)
D β†’ P-2 (ννΈ: S-1 μ •λ‹µ)
```

#### λΌμ΄λ“ 3 (Cycle 3)
```
A β†’ R-3 (ννΈ: P-1, Q-2 μ •λ‹µ)
B β†’ S-3 (ννΈ: Q-1, R-2 μ •λ‹µ)
C β†’ P-3 (ννΈ: R-1, S-2 μ •λ‹µ)
D β†’ Q-3 (ννΈ: S-1, P-2 μ •λ‹µ)
```

#### λΌμ΄λ“ 4 (Cycle 4)
```
A β†’ S-4 (ννΈ: P-1, Q-2, R-3 μ •λ‹µ)
B β†’ P-4 (ννΈ: Q-1, R-2, S-3 μ •λ‹µ)
C β†’ Q-4 (ννΈ: R-1, S-2, P-3 μ •λ‹µ)
D β†’ R-4 (ννΈ: S-1, P-2, Q-3 μ •λ‹µ)
```

### μν™ ν¨ν„΄
```
ν•™μƒ A: P β†’ Q β†’ R β†’ S
ν•™μƒ B: Q β†’ R β†’ S β†’ P
ν•™μƒ C: R β†’ S β†’ P β†’ Q
ν•™μƒ D: S β†’ P β†’ Q β†’ R
```

## π’΅ ννΈ νλ„ν‹° μ‹μ¤ν…

### λ¬Έμ  μƒν™©
- μ΄μ „ ν€μ›μ΄ λ¬Έμ λ¥Ό ν‹€λ Έμ„ μ μμ
- ν‹€λ¦° μ •λ‹µμ„ ννΈλ΅ λ°›μΌλ©΄ λ‹¤μ λ¬Έμ λ„ ν‹€λ¦΄ μ„ν—

### ν•΄κ²°μ±…: ννΈ ν™•μΈ λ²„νΌ
**"μ΄μ „ μ¬λ°”λ¥Έ μ •λ‹µ ν™•μΈν•κΈ°"** λ²„νΌ μ κ³µ

#### μ‘λ™ λ°©μ‹
1. λ²„νΌ ν΄λ¦­
2. ν™•μΈ λ‹¤μ΄μ–Όλ΅κ·Έ ν‘μ‹
3. ν™•μΈ μ‹:
   - β **-100μ  κ°μ **
   - β… **μ¬λ°”λ¥Έ μ •λ‹µ κ³µκ°**
   - π“ **ννΈ μ‚¬μ© κΈ°λ΅ μ €μ¥**

#### μ¬μ‚¬μ©
- κ°™μ€ ννΈλ¥Ό λ‹¤μ‹ ν™•μΈν•  λ•λ” **μ¶”κ°€ κ°μ  μ—†μ**
- μ΄λ―Έ κ³µκ°λ μ •λ‹µμ€ λ¬΄λ£λ΅ λ‹¤μ‹ λ³Ό μ μμ

### μ „λµμ  μ„ νƒ
```
μƒν™©: μ΄μ „ μ •λ‹µμ΄ μμ‹¬μ¤λ¬μ›€

μ„ νƒ A: μ¶”μΈ΅ν•΄μ„ ν’€κΈ°
  - μ¥μ : κ°μ  μ—†μ
  - λ‹¨μ : ν‹€λ¦΄ μ„ν—

μ„ νƒ B: -100μ  λ°›κ³  μ •λ‹µ ν™•μΈ
  - μ¥μ : ν™•μ‹¤ν• μ •λ‹µ ν™•λ³΄
  - λ‹¨μ : 100μ  μ†μ‹¤
```

## π—„οΈ λ°μ΄ν„°λ² μ΄μ¤ κµ¬μ΅°

### μƒλ΅ μ¶”κ°€λ ν…μ΄λΈ”

#### `relay_quiz_hint_usage`
```sql
- id: UUID (PK)
- session_id: UUID (FK)
- team_id: UUID (FK)
- participant_id: UUID (FK)
- cycle_number: INTEGER
- question_order: INTEGER
- revealed_answer: TEXT
- penalty_points: INTEGER (-100)
- used_at: TIMESTAMP
```

### μμ •λ ν…μ΄λΈ”

#### `relay_quiz_team_progress`
μ¶”κ°€λ μ»¬λΌ:
- `hints_used`: INTEGER - μ‚¬μ©ν• ννΈ κ°μ
- `hint_penalty_total`: INTEGER - μ΄ ννΈ νλ„ν‹°
- `revealed_answers`: JSONB - κ³µκ°λ μ •λ‹µ λ©λ΅

## π”§ μ£Όμ” ν•¨μ

### 1. `use_relay_quiz_hint()`
μ΄μ „ μ •λ‹µ ν™•μΈ (-100μ )

**νλΌλ―Έν„°:**
- `p_session_id`: μ„Έμ… ID
- `p_team_id`: ν€ ID
- `p_participant_id`: μ°Έκ°€μ ID
- `p_question_order`: ν™•μΈν•  λ¬Έμ  μμ„

**λ°ν™κ°’:**
- `hint_id`: ννΈ μ‚¬μ© κΈ°λ΅ ID
- `revealed_answer`: κ³µκ°λ μ •λ‹µ
- `penalty_points`: νλ„ν‹° μ μ (-100)
- `new_total_score`: μƒλ΅μ΄ μ΄μ 
- `success`: μ„±κ³µ μ—¬λ¶€
- `message`: λ©”μ‹μ§€

### 2. `get_available_hints()`
μ‚¬μ© κ°€λ¥ν• ννΈ λ©λ΅ μ΅°ν

**νλΌλ―Έν„°:**
- `p_session_id`: μ„Έμ… ID
- `p_team_id`: ν€ ID

**λ°ν™κ°’:**
- `question_order`: λ¬Έμ  μμ„
- `can_reveal`: κ³µκ° κ°€λ¥ μ—¬λ¶€
- `already_revealed`: μ΄λ―Έ κ³µκ°λ¨
- `revealed_answer`: κ³µκ°λ μ •λ‹µ (μλ” κ²½μ°)
- `penalty_points`: νλ„ν‹° μ μ

### 3. `submit_relay_quiz_answer_with_hints()`
λ‹µμ• μ μ¶ (ννΈ μ •λ³΄ ν¬ν•¨)

**νλΌλ―Έν„°:**
- `p_session_id`: μ„Έμ… ID
- `p_team_id`: ν€ ID
- `p_participant_id`: μ°Έκ°€μ ID
- `p_answer`: λ‹µμ•

**λ°ν™κ°’:**
- `attempt_id`: μ‹λ„ ID
- `is_correct`: μ •λ‹µ μ—¬λ¶€
- `is_cycle_complete`: μ‚¬μ΄ν΄ μ™„λ£ μ—¬λ¶€
- `next_question_order`: λ‹¤μ λ¬Έμ  μμ„
- `available_hints`: μ‚¬μ© κ°€λ¥ν• ννΈ (JSONB)
- `success`: μ„±κ³µ μ—¬λ¶€
- `message`: λ©”μ‹μ§€

## π¨ UI κµ¬μ„± (μμ‹)

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ Relay Quiz - Cycle 3                        β”‚
β”‚ ν„μ¬ λ¬Έμ : R-3                               β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ μ΄μ „ μ •λ‹µ ννΈ:                              β”‚
β”‚                                              β”‚
β”‚ P-1: "42" [ν™•μΈν•κΈ° -100μ ] β οΈ              β”‚
β”‚ Q-2: "μ •λ‹µ ν™•μΈλ¨: 78" β…                    β”‚
β”‚                                              β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ λ¬Έμ : λ‹¤μ μμ—΄μ λ‹¤μ μ«μλ”?              β”‚
β”‚ 1, 1, 2, 3, 5, 8, ?                         β”‚
β”‚                                              β”‚
β”‚ λ‹µμ•: [_____________]                       β”‚
β”‚                                              β”‚
β”‚ [μ μ¶ν•κΈ°]                                   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

ν€ μ μ: 850μ 
ννΈ μ‚¬μ©: 1ν (-100μ )
```

## π“ μ μ κ³„μ‚°

### κΈ°λ³Έ μ μ
- μ •λ‹µ: +λ¬Έμ  λ°°μ  (μ: 100μ )
- μ¤λ‹µ: 0μ 

### ννΈ νλ„ν‹°
- ννΈ μ‚¬μ©: -100μ 
- μ¬ν™•μΈ: 0μ  (μ¶”κ°€ κ°μ  μ—†μ)

### μμ‹
```
μ΄κΈ° μ μ: 1000μ 

λΌμ΄λ“ 2:
- P-1 ννΈ ν™•μΈ: -100μ  β†’ 900μ 
- Q-2 μ •λ‹µ: +100μ  β†’ 1000μ 

λΌμ΄λ“ 3:
- P-1 ννΈ μ¬ν™•μΈ: 0μ  β†’ 1000μ  (λ¬΄λ£)
- R-3 μ •λ‹µ: +100μ  β†’ 1100μ 

μµμΆ… μ μ: 1100μ 
ννΈ μ‚¬μ©: 1ν
```

## π”„ μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ

### Supabase Realtime κµ¬λ…
- `relay_quiz_hint_usage` ν…μ΄λΈ” λ³€κ²½ κ°μ§€
- ννΈ μ‚¬μ© μ‹ μ¦‰μ‹ λ°μ
- ν€ μ μ μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ

## β… κµ¬ν„ μ™„λ£ ν•­λ©

- [x] ννΈ μ‚¬μ© κΈ°λ΅ ν…μ΄λΈ”
- [x] ννΈ νλ„ν‹° μ‹μ¤ν… (-100μ )
- [x] ννΈ μ‚¬μ© ν•¨μ
- [x] μ‚¬μ© κ°€λ¥ν• ννΈ μ΅°ν
- [x] λ‹µμ• μ μ¶ (ννΈ μ •λ³΄ ν¬ν•¨)
- [x] RLS μ •μ±…
- [x] μ‹¤μ‹κ°„ κµ¬λ…
- [x] λ°μ΄ν„°λ² μ΄μ¤ λ§μ΄κ·Έλ μ΄μ…

## π― λ‹¤μ λ‹¨κ³„

### UI μ»΄ν¬λ„νΈ κµ¬ν„
1. **RelayQuizPlayView** - ν”λ μ΄μ–΄ ν™”λ©΄
   - ν„μ¬ λ¬Έμ  ν‘μ‹
   - μ΄μ „ μ •λ‹µ ννΈ μμ—­
   - ννΈ ν™•μΈ λ²„νΌ
   - λ‹µμ• μ…λ ¥ λ° μ μ¶

2. **RelayQuizAdmin** - κ΄€λ¦¬μ ν™”λ©΄
   - μ‚¬μ΄ν΄ μ§„ν–‰ κ΄€λ¦¬
   - ν€λ³„ μ§„ν–‰ μƒν™©
   - ννΈ μ‚¬μ© ν†µκ³„

3. **RelayQuizScoreboard** - μ μν
   - ν€λ³„ μ μ
   - ννΈ μ‚¬μ© ν„ν™©
   - μ§„ν–‰ μƒν™©

---

**Relay Gameμ ν•µμ‹¬ λ©”μ»¤λ‹μ¦μ΄ μ™„μ„±λμ—μµλ‹λ‹¤! π‰**